<style type="text/css">
#GLAWindowMenu{
	z-index: 2147483647;
	display: none;
	position: absolute;
	top: 0px;
	right: 0px;
	padding: 4px;
	margin-right: -55px;
	height: 98.8%;
	background-color: rgba(200,200,200,0.5);
}
#GLAWindowMenu a img{
	border: 0;
}
.GLAMenuButton{
	width: 48px;
	height: 48px;
	display: block;
	margin-bottom: 4px;
}
</style>
<div id="GLAWindowMenu">
	<img onclick="javascript:GLA.CloseWindow();" class="GLAMenuButton" id="GLACloseButton" src="http://localhost:5555/resources/system/window/menu/close-icon.png"/>
	<img onclick="javascript:GLA.ZoomIn(500);" class="GLAMenuButton" id="GLAZoomInButton" src="http://localhost:5555/resources/system/window/menu/zoom-in-icon.png"/>
	<img onclick="javascript:GLA.ZoomOut(500);" class="GLAMenuButton" id="GLAZoomOutButton" src="http://localhost:5555/resources/system/window/menu/zoom-out-icon.png"/>
	<img onclick="javascript:GLA.EnterFullscreen();" class="GLAMenuButton" id="GLAMaximizeButton" src="http://localhost:5555/resources/system/window/menu/maximize-icon.png"/>
	<img onclick="javascript:GLA.ExitFullscreen();" class="GLAMenuButton" id="GLARestoreButton" src="http://localhost:5555/resources/system/window/menu/restore-icon.png"/>
</div>
<script language="javascript">
/* DO NOT USE INLINE COMMENTS! They will cause issues when injecting this code in the 
   windows. Multiline comments are OK. */

document.addEventListener('GLAWindowMenuFeaturesChanged', onWindowMenuFeaturesChanged, false);
function onWindowMenuFeaturesChanged(event) {
	event.preventDefault();
	if (!event.buttons.close) $jsafe("#GLACloseButton").hide();
	else $jsafe("#GLACloseButton").show();

	if (!event.buttons.zoomIn) $jsafe("#GLAZoomInButton").hide();
	else $jsafe("#GLAZoomInButton").show();

	if (!event.buttons.zoomOut) $jsafe("#GLAZoomOutButton").hide();
	else $jsafe("#GLAZoomOutButton").show();

	if (!event.buttons.maximize) $jsafe("#GLAMaximizeButton").hide();
	else $jsafe("#GLAMaximizeButton").show();

	if (!event.buttons.restore) $jsafe("#GLARestoreButton").hide();
	else $jsafe("#GLARestoreButton").show();
}

document.addEventListener('GLAZoomCompleted', onGLAZoomCompleted, false);
function onGLAZoomCompleted(event) {
	GLA.AdjustMenu(false);
	if (GLA.menuVisible) GLA.ShowWindowMenu();
}

GLA.menuSpeed = 350;
GLA.menuMoveThreshold = 25;
GLA.menuVisible = false;
GLA.PADDING = 4;
GLA.overflowSettings = $jsafe("body").css("overflow");

GLA.ShowWindowMenu = function(){
  var menu = $jsafe("#GLAWindowMenu");
  $jsafe("body").css("overflow", "hidden");
  menu.show();
  menu.animate({
      marginRight: 0,
      top: $jsafe(window).scrollTop() / GLA.GetZoom()
  }, GLA.menuSpeed, function(){
  	 GLA.menuVisible  = true;
  });
};

GLA.HideWindowMenu = function(immediate){
	var menu = $jsafe("#GLAWindowMenu");
	menu.animate({
	  marginRight: -menu.outerWidth()
	}, GLA.menuSpeed, function() {
	    menu.hide();
	    $jsafe("body").css("overflow", GLA.overflowSettings);
	  	GLA.menuVisible  = false;
	});
};

GLA.AdjustMenu = function(adjustVertical){
	if (adjustVertical == undefined) adjustVertical = true;

	var PERCENTAGE = 0.07; /* The menu will take 7% of the width of the window */
	var zoom = GLA.GetZoom();

	var winWidth = $jsafe(window).width();
	var docWidth = $jsafe(document).width();
	var scrollAmount = $jsafe(window).scrollLeft();

    if (adjustVertical) $jsafe("#GLAWindowMenu").css("top", $jsafe(window).scrollTop() / zoom + "px");

	marginRight = -(docWidth * PERCENTAGE + GLA.PADDING*2);
	if (GLA.menuVisible){
		marginRight += $jsafe("#GLAWindowMenu").outerWidth();
	}
	$jsafe('#GLAWindowMenu').css('margin-right', marginRight + 'px');
	$jsafe('#GLAWindowMenu').css('padding', GLA.PADDING + 'px');

	$jsafe('.GLAMenuButton').css('width', (docWidth * PERCENTAGE) + 'px');
	$jsafe('.GLAMenuButton').css('height', (docWidth * PERCENTAGE) + 'px');

	$jsafe('#GLAWindowMenu').css('right', -scrollAmount / zoom + "px");
};

$jsafe(window).scroll(function(){
	GLA.AdjustMenu();
});

$jsafe(document).ready(function(){
	GLA.AdjustMenu();
});

$jsafe(document).click(function(e){
	/* What part of the document did we touch? */

	/* Right part (with a little of a threshold) */
	if (e.pageX + ($jsafe(document).width() - $jsafe(window).width() - $jsafe(window).scrollLeft()) > ($jsafe(document).width() - parseInt($jsafe('#GLACloseButton').css('width')) * 2)){
		if (!GLA.menuVisible){
			GLA.ShowWindowMenu();
			return true;
		}
	}

	/* Left part */
	else if (e.pageX + ($jsafe(document).width() - $jsafe(window).width() - $jsafe(window).scrollLeft()) < ($jsafe(document).width() - parseInt($jsafe('#GLACloseButton').css('width'))) - GLA.PADDING * 2){
		if (GLA.menuVisible){
			GLA.HideWindowMenu();
			return true;
		}
	}
});



</script>
